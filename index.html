<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" href="style.css"/>
		<script type="text/javascript" src="jquery-1.11.3.min.js"></script>
		
		<script>
		  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		  ga('create', 'UA-68436781-1', 'auto');
		  ga('send', 'pageview');
		</script>
		
	</head>

	<body>
		<video width="100%" height="auto" id="inline-video" controls="true" type="video/mp4">
				<source src="470127_vocalink_timeline_v1_720mp4.mp4" type="video/mp4">
		</video>
		<div id="current">0:00</div>
		<div id="duration">0:00</div>

		<script>
			$(document).ready(function(){
			  
			  // videoStatus will be an array of booeans where 0 = 25% viewed, 1 = 50%, 2 = 75% & 3 = 100%
			  var videoStatus = [false, false, false, false];
			  var secondsCounter = 0.0;
			  $("#inline-video").on("timeupdate", function(event){
				  var changeInTime = this.currentTime - secondsCounter;
				  if(changeInTime > 0.25 || this.currentTime == this.duration) {
					  videoStatus = onTrackedVideoFrame(this.currentTime, this.duration, videoStatus);
				  }
				  secondsCounter = this.currentTime;
				});
			});
			
			function onTrackedVideoFrame(currentTime, duration, videoStatus){
				var url = $("#inline-video").find('source').attr('src');
				var totTime = parseInt(duration.toFixed());
				var quartTime = parseInt((totTime / 4).toFixed());
				var halfTime = parseInt((totTime / 2).toFixed());
				var threeQuartTime = totTime - quartTime;  
				var elapsedTime = parseInt(currentTime.toFixed());
			
				if(elapsedTime == quartTime && !videoStatus[0]){
					console.log("Video 25% viewed of " + url);
					ga('send','event','VideoViews','25% viewed of ' + url);
					videoStatus[0] = true;
				}
				if(elapsedTime == halfTime && !videoStatus[1]){
					console.log("Video 50% viewed");
					ga('send','event','VideoViews','50% viewed of ' + url);
					videoStatus[1] = true;
				}
				if(elapsedTime == threeQuartTime && !videoStatus[2]){
					console.log("Video 75% viewed");
					ga('send','event','VideoViews','75% viewed of ' + url);
					videoStatus[2] = true;
				}
				if(currentTime == duration && !videoStatus[3]){
					console.log("Video 100% viewed");
					ga('send','event','VideoViews','100% viewed of ' + url);
					videoStatus[3] = true;
				}
			
				$("#current").text(currentTime);
				$("#duration").text(duration);
				
				return videoStatus;
				
			}
		</script>

	</body>
</html>